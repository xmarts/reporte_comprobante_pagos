<odoo>
     <template id="id_reporte_pagos" inherit_id="l10n_mx_edi.report_payment_document_mx">
        <xpath expr="//table[hasclass('table-sm')][2]" position="replace">
            <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Invoice</th>
                            <th>UUID</th>
                            <th class="text-right">Partiality</th>
                            <th class="text-right">Previous balance</th>
                            <th class="text-right">Amount Paid</th>
                            <th class="text-right">Balance</th>
                            <th>Currency</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="docs_related" t-as="inv">
                            <t t-if="inv.get('ImpSaldoAnt') != inv.get('ImpPagado') ">
                                <td><span t-esc="o.invoice_ids.filtered(lambda i: i.l10n_mx_edi_cfdi_uuid == inv.get('IdDocumento')).number or ''"/></td>
                                <td><span t-esc="inv.get('IdDocumento')"/></td>
                                <td class="text-right">1</td>
                                <td class="text-right"><span t-esc="inv.get('ImpSaldoAnt', '')"/></td>
                                <td class="text-right"><span t-esc="inv.get('ImpPagado', '')"/></td>
                                <td class="text-right"><span t-esc="inv.get('ImpSaldoInsoluto', '')"/></td>
                                <td><span t-esc="inv.get('MonedaDR')"/></td>
                            </t>    
                        </tr>
                    </tbody>
                </table>
        </xpath>
        
         <xpath expr="//table[hasclass('table-sm')][2]" position="after">
           <t t-if="docs.l10n_mx_edi_factoring_id">  
            <h4 class="text-center" style="margin-top:2em; margin-bottom:1em; text-decoration:underline;"> Documentos Relacionados </h4>
            <table class="table table-sm o_main_table">
               <t t-set="xml" t-value="docs.l10n_mx_edi_get_xml_etree()" />
               <t t-set="comp" t-value="xml.Complemento" />
               <t t-set="tfd" t-value="docs.l10n_mx_edi_get_pago_etree(xml)" />
               <!-- <span t-field="docs.payments_widget" />-->
                <thead>
                    <tr>
                        <th>Id Documento</th>
                        <th>Serie</th>
                        <th>Moneda</th>
                        <th>Tipo Cambio</th>
                        <th>Parcialidad</th>
                        <th>Metodo de Pago</th>
                        <th>Saldo Anterior</th>
                        <th>Saldo Pagado</th>
                        <th>Saldo Insoluto</th>
                    </tr>
                </thead>
                <tbody class="sale_tbody">

                    <t  t-foreach="docs_related" t-as="inv">
                         <t t-foreach="docs.invoice_lines" t-as="a">
                            <t t-if="a.comision_col == true and a.invoice == o.invoice_ids.filtered(lambda i: i.l10n_mx_edi_cfdi_uuid == inv.get('IdDocumento')).number">
                                <tr>
                                    <t t-set="pagval" t-value="0" />
                                        <t t-if="inv.get('ImpSaldoInsoluto') == '00.0'" >
                                            <t t-if="inv.get('MetodoDePagoDR') == 'PUE'">
                                                <t t-set="pagval" t-value="'PUE - Pago en una sola exibicion'" />
                                            </t>
                                            <t t-if="inv.get('MetodoDePagoDR') == 'PPD'">
                                                <t t-set="pagval" t-value="'PPD - Pago en parcialidades o diferido'" />
                                            </t>

                                            <td><span t-esc="inv.get('IdDocumento')"/></td>
                                            <td><span t-esc="o.invoice_ids.filtered(lambda i: i.l10n_mx_edi_cfdi_uuid == inv.get('IdDocumento')).number or ''"/></td>
                                            <td><span t-esc="inv.get('MonedaDR')"/></td>
                                            <td></td>
                                            <td class="text-right">2</td>
                                            <td class="text-right"><span t-esc="pagval" /> </td>
                                            <td class="text-right"><span t-esc="inv.get('ImpSaldoAnt', '')"/></td>
                                            <td class="text-right"><span t-esc="inv.get('ImpPagado', '')"/></td>
                                            <td class="text-right"><span t-esc="inv.get('ImpSaldoInsoluto', '')"/></td>

                                        </t>
                                </tr>
                            </t>
                        </t>    
                    </t>
                </tbody>
            </table>
        </t>
        </xpath>
       </template> 
</odoo>